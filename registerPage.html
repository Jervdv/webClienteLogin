<!DOCTYPE html>
<html lang="br">
    <head>
        <link rel="stylesheet" href="style.css">
        <title>Cadastrar</title>
    </head>
    <body>
        <div class="container">
            <form action="" id="cadastroForm">
                <h2>Cadastrar novo Login</h2>

                <input type="text" id="username" class="form-control" placeholder="Insira seu novo Username...">
                <input type="text" id="password" class="form-control" placeholder="Insira sua nova Senha...">
                
                <button type="submit">Cadastrar</button>
                <a href="loginPage.html">Retornar</a>
            </form>     
        </div>
        <script>
            let loginForm = document.getElementById("cadastroForm");

            loginForm.addEventListener("submit", (e)=> {
                e.preventDefault();

                let usernameField = document.getElementById("username");
                let passwordField = document.getElementById("password");
                
                let loginText = "";
                if (null === localStorage.getItem("logins")){
                    const temptext  = [{uname:"admin", pw:"admin"}];
                    localStorage.setItem("logins", JSON.stringify(temptext));
                }
                loginText = localStorage.getItem("logins");

                var loginJson = JSON.parse(loginText);


                if (usernameField.value == "" || passwordField.value == "") {
                    alert("Insira valor em ambos os campos!");
                } else {
                    let jaExiste = false;
                    for(let i = 0; i <  loginJson.length; i++){
                        if(loginJson[i].uname == usernameField.value){
                            passwordField.value = "";
                            usernameField.value = "";
                            alert("usuario ja existe!");
                            jaExiste = true;
                            usernameField.focus();
                            break;
                        }
                    }
                    if (!jaExiste){
                        let newUser = {
                            "uname":username.value,
                            "pw": password.value
                        }
                        loginJson.push(newUser);
                        localStorage.setItem("logins", JSON.stringify(loginJson));
                        alert("cadastrado usario \"" + username.value + "\" com senha \""+ password.value + "\"");
                        password.value = "";
                        username.value = "";
                        window.location.replace('loginPage.html');
                    }
                }
            });
        </script>
    </body>
</html>