<!DOCTYPE html>
<html lang="br">
    <head>
        <link rel="stylesheet" href="style.css">
        <title> Login Page </title>
    </head>
    <body>
        <div class="container">
            <form action="" id="loginForm">
                <h1>Login</h1>

                <input type="text" id="username" class="form-control" placeholder="Insira seu Username...">
                <input type="password" id="password" class="form-control" placeholder="Insira sua Senha...">
                
                <input type="checkbox" id="manter"> Permanecer Conectado?
                <button type="submit">Login</button>

                
                <a href="registerPage.html">Cadastrar novo login</a>
            </form>     
        </div>
           
        <script>
            let loginForm = document.getElementById("loginForm");

            loginForm.addEventListener("submit", (e)=> {
                e.preventDefault();

                let usernameField = document.getElementById("username");
                let passwordField = document.getElementById("password");
                let manter = document.getElementById("manter");

                if (null === localStorage.getItem("logins")){
                    let newMap = new Map();
                    let newUuid = crypto.randomUUID();
                    newMap.set("admin", {pw: "admin", uuid : newUuid});
                    const temptext  = [{uname:"admin", pw:"admin"}];
                    localStorage.setItem("logins", JSON.stringify(temptext));
                    console.log(JSON.stringify(newMap));
                }
                
                if (username.value == "" || password.value == "") {
                    alert("Insira valor em ambos os campos!");

                } else if (null === localStorage.getItem("logins")){
                    const temptext  = [{uname:"admin", pw:"admin"}];
                    localStorage.setItem("logins", JSON.stringify(temptext));
                
                } else {
                    let loginJson = JSON.parse(localStorage.getItem("logins"));
                    loginJson.forEach(user => {
                        if( user.uname == usernameField.value){
                            if(user.pw == passwordField.value){
                                localStorage.setItem("loggeduser", username.value);
                                password.value = "";
                                username.value = "";
                                location.replace("index.html");

                            } else {
                                alert("Senha Incorreta!");
                                password.value = "";
                                passwordField.focus();
                            }
                        }
                    });
                }
            });
        </script>
    </body>
</html>
